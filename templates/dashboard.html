<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ role }} Dashboard | Loan System</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

    <nav class="dashboard-nav">
        <div class="container">
            <div class="logo">LOAN SYSTEM - {{ role.upper() }}</div>
            <ul class="nav-links">
                <li><a href="{{ url_for('dashboard') }}" class="active">DASHBOARD</a></li>
                <li><a href="{{ url_for('about') }}">ABOUT</a></li>
                <li><a href="{{ url_for('contact') }}">CONTACT</a></li>
                <li><a href="{{ url_for('logout') }}">LOGOUT</a></li>
            </ul>
        </div>
    </nav>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="flash-messages" style="position: fixed; top: 70px; width: 100%; max-width: 1200px; z-index: 999; margin: 0 auto; padding: 0 30px;">
            {% for category, message in messages %}
                <p class="{{ category }}">{{ message }}</p>
            {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <div class="dashboard-wrapper">
        <h2>Welcome, {{ fullname }}!</h2>
        <p>You are logged in as <strong>{{ role }}</strong>.</p>

        {% if role == 'Admin' %}

            <div class="dashboard-section">
                <h3>Admin Controls</h3>
                <p>Manage all system operations, users, and loan life cycles.</p>
                <ul>
                    <li><span class="check-icon">✔</span> View and manage all borrower accounts</li>
                    <li><span class="check-icon">✔</span> Review and approve loan applications</li>
                    <li><span class="check-icon">✔</span> Monitor payment statuses and balances</li>
                    <li><span class="check-icon">✔</span> Generate comprehensive loan reports</li>
                </ul>
            </div>

            <div class="dashboard-section">
                <h3>Quick Actions</h3>
                <a href="{{ url_for('admin_dashboard') }}" class="btn primary-btn">Go to Admin Panel</a>
                <a href="#" class="btn secondary-btn">View Borrowers</a>
                <a href="#" class="btn tertiary-btn">Generate Report</a>
            </div>

        {% elif role == 'Borrower' %}

    <div class="dashboard-section">
        <h3>Your Current Loans & Applications</h3>
        <p>This table shows loans that are **Pending** approval or **Approved** with a remaining balance. Loans that are fully paid are moved to Payment History.</p>

        {% if user_loans %}
            <table>
                <thead>
                    <tr>
                        <th>Loan ID</th>
                        <th>Amount</th>
                        <th>Current Balance</th> <th>Term (Months)</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for loan in user_loans %}
                    <tr>
                        <td><strong>#{{ loan.id }}</strong></td>
                        <td>₱{{ "{:,.2f}".format(loan.amount) }}</td>
                        <td>₱{{ "{:,.2f}".format(loan.balance) }}</td> <td>{{ loan.term_months }}</td>
                        <td>
                            <strong class="status-{{ loan.status | lower }}">
                                {{ loan.status }}
                            </strong>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>You have no current active or pending loan applications.</p>
        {% endif %}
    </div>

    <div class="dashboard-section">
        <h3>Payment History</h3>
        <p>These are the payments you have made that have been **Approved** by the administrator.</p>

        {% if user_payments %}
            <table>
                <thead>
                    <tr>
                        <th>Payment ID</th>
                        <th>Loan ID</th>
                        <th>Amount Paid</th>
                        <th>Method</th>
                        <th>Date Paid</th>
                    </tr>
                </thead>
                <tbody>
                    {% for payment in user_payments %}
                    <tr>
                        <td>#{{ payment.id }}</td>
                        <td><strong>#{{ payment.loan_id }}</strong></td>
                        <td>₱{{ "{:,.2f}".format(payment.amount) }}</td>
                        <td>{{ payment.method }}</td>
                        <td>{{ payment.payment_date.strftime('%Y-%m-%d %I:%M %p') }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>No approved payment records found.</p>
        {% endif %}
    </div>

    <div class="dashboard-section">
        <h3>Quick Actions</h3>
        <a href="{{ url_for('apply_loan') }}" class="btn primary-btn">Apply for Loan</a>
        <a href="{{ url_for('payment') }}" class="btn secondary-btn">Make a Payment</a>
        <a href="{{ url_for('update_profile') }}" class="btn tertiary-btn">Update Profile</a>
    </div>

{% endif %}

    </div>
  </body>
</html>
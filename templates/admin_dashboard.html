{% include 'base.html' %}
{% block content %}
<div class="admin-dashboard-container">

    <div class="admin-header-row">
        <h2>Admin Dashboard: Welcome, {{ fullname }}</h2>
        <a href="{{ url_for('logout') }}" class="logout-btn">LOGOUT</a>
    </div>

    <div class="admin-overview-cards">
        <a href="{{ url_for('view_all_users') }}" class="card-link user-card">
            <h3>ðŸ‘¥ All Users</h3>
            <p>{{ user_count }} Accounts</p>
            <span class="card-action">View Details &rarr;</span>
        </a>
        <a href="{{ url_for('view_all_loans') }}" class="card-link loan-card">
            <h3>ðŸ’° All Loans</h3>
            <p>{{ loan_count }} Total Loans</p>
            <span class="card-action">View Details &rarr;</span>
        </a>
        <a href="{{ url_for('view_all_payments') }}" class="card-link payment-card">
            <h3>ðŸ’¸ All Payments</h3>
            <p>{{ payment_count }} Total Transactions</p>
            <span class="card-action">View Details &rarr;</span>
        </a>
    </div>

    <div class="admin-approval-section dark-card">
        <h3>Pending Approvals</h3>

        <h4>Pending User Registration ({{ pending_users|length }})</h4>
        {% if pending_users %}
            <table class="dark-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Role</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in pending_users %}
                    <tr>
                        <td>{{ user.id }}</td>
                        <td>{{ user.fullname }}</td>
                        <td>{{ user.email }}</td>
                        <td>{{ user.role }}</td>
                        <td>
                            <form method="POST" action="{{ url_for('approve_user', user_id=user.id) }}" style="display:inline;">
                                <button type="submit" class="approve-btn">Approve</button>
                            </form>
                            <form method="POST" action="{{ url_for('deny_user', user_id=user.id) }}" style="display:inline; margin-left: 10px;">
                                <button type="submit" class="reject-btn">Deny</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p class="no-pending">ðŸŽ‰ No pending user registrations.</p>
        {% endif %}

        <h4>Pending Loan Applications ({{ pending_loans|length }})</h4>
        {% if pending_loans %}
            <table class="dark-table">
                <thead>
                    <tr>
                        <th>Loan ID</th>
                        <th>Borrower</th>
                        <th>Amount</th>
                        <th>Term (Months)</th>
                        <th>Purpose</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for loan in pending_loans %}
                    <tr>
                        <td>{{ loan.id }}</td>
                        <td>{{ loan.borrower.fullname }}</td>
                        <td>â‚±{{ '{:,.2f}'.format(loan.amount) }}</td>
                        <td>{{ loan.term_months }}</td>
                        <td>{{ loan.purpose }}</td>
                        <td>
                            <form method="POST" action="{{ url_for('approve_loan', loan_id=loan.id) }}" style="display:inline;">
                                <button type="submit" class="approve-btn loan-btn">Approve Loan</button>
                            </form>
                            <form method="POST" action="{{ url_for('deny_loan', loan_id=loan.id) }}" style="display:inline; margin-left: 10px;">
                                <button type="submit" class="reject-btn loan-btn">Deny</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p class="no-pending">ðŸŽ‰ No pending loan applications.</p>
        {% endif %}

        <h4>Pending Payment Requests ({{ pending_payments|length }})</h4>
        {% if pending_payments %}
            <table class="dark-table">
                <thead>
                    <tr>
                        <th>Payment ID</th>
                        <th>Loan ID</th>
                        <th>Borrower</th>
                        <th>Amount Paid</th>
                        <th>Method</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for payment in pending_payments %}
                    <tr>
                        <td>{{ payment.id }}</td>
                        <td>{{ payment.loan_id }}</td>
                        <td>{{ payment.borrower.fullname }}</td>
                        <td>â‚±{{ '{:,.2f}'.format(payment.amount) }}</td>
                        <td>{{ payment.method }}</td>
                        <td>
                            <form method="POST" action="{{ url_for('approve_payment', payment_id=payment.id) }}" style="display:inline;">
                                <button type="submit" class="approve-btn payment-btn">Approve Payment</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p class="no-pending">ðŸŽ‰ No pending payment requests.</p>
        {% endif %}

    </div>
</div>
{% endblock %}